<body></body>
<style>
	body{
		margin:0px;
	}
</style>
<script src='c0.js'></script>
<script>
	c0.run('resize')
	var g={
		
	}
	var c1=c0.circ({
		rad:50,
		color:'green',
		x:200,
		y:300
	}).to()
	var c2=c0.circ({
		rad:4,
		color:'red',
		x:200,
		y:300
	}).to()
	var c3=c0.circ({
		rad:4,
		color:'blue',
		x:200,
		y:300
	}).to()
	var l1=c0.line({
		p1:{x:0,y:0},
		p2:{x:400,y:400},
		linewid:2,
		color:'green'
	}).to()
	var l2=c0.line({
		p1:{x:0,y:0},
		p2:{x:400,y:400},
		linewid:2,
		color:'yellow'
	}).to()
	var l3=c0.line({
		p1:{x:0,y:0},
		p2:{x:400,y:400},
		linewid:2,
		color:'red'
	}).to()
	
	function lerp(p,that,t){
		return {
			x:p.x + (that.x - p.x) * t,
			y:p.y + (that.y - p.y) * t
		}
	}
	
	function cl(c,l){
		var r=c.rad,
			a1=l.p1,
			a2=l.p2		
		
		var result;
		var a = (a2.x - a1.x) * (a2.x - a1.x) + (a2.y - a1.y) * (a2.y - a1.y);
		var b = 2 * ((a2.x - a1.x) * (a1.x - c.x) + (a2.y - a1.y) * (a1.y - c.y));
		var cc = c.x * c.x + c.y * c.y + a1.x * a1.x + a1.y * a1.y - 2 * (c.x * a1.x + c.y * a1.y) - r * r;
		var deter = b * b - 4 * a * cc;
		if (deter < 0) {
			//result = "Outside"
		} else if (deter == 0) {
			//result = "Tangent"
		} else {
			var e = Math.sqrt(deter);
			var u1 = (-b + e) / (2 * a);
			var u2 = (-b - e) / (2 * a);
			if ((u1 < 0 || u1 > 1) && (u2 < 0 || u2 > 1)) {
				if ((u1 < 0 && u2 < 0) || (u1 > 1 && u2 > 1)) {
					//result = "Outside"
				} else {
					//result = "Inside"
				}
			} else {
				result = {points:[]}
				if (0 <= u1 && u1 <= 1) result.points.push(lerp(a1,a2, u1));
				if (0 <= u2 && u2 <= 1) result.points.push(lerp(a1,a2, u2));
			}
		}		
		return result;
	}
	function dostuff(dt){
		l1.p1.x=c0.m.x
		l1.p1.y=c0.m.y
		/*
		var col=c0.cl(c1,l1)
		if(col){
			l2.p1.x=col.hit.x
			l2.p1.y=col.hit.y
		}
		console.log('col:',col)
		/**/
		var res=cl(c1,l1)
		if(res){
			c2.x=res.points[0].x
			c2.y=res.points[0].y
			l2.p1=c2.pos()
			
			var vec=c0.sub(res.points[0],c1.getpos())
			l2.p2.x=res.points[0].x+vec.x*10
			l2.p2.y=res.points[0].y+vec.y*10
			var an1=c0.an(l1.p1,l1.p2)
			
			var an2=c0.an(c1.getpos(),res.points[0])			
			dif=an1-an2
			//console.log(dif)
			
			l3.p1.x=res.points[0].x
			l3.p1.y=res.points[0].y
			
			vec2=c0.rot(vec,-dif)
			l3.p2.x=res.points[0].x+vec2.x*10
			l3.p2.y=res.points[0].y+vec2.y*10
			
			
			if(res.points[1]){
				c3.x=res.points[1].x
				c3.y=res.points[1].y
			}
		}
	}
	c0.canvas.on('mousemove',function(e){
		dostuff()
	})
	//c0.ondraw=
	
	
</script>